# Using Prediction in an Application

## Introduction

In this lab, you will:

- Import data to set up the lab.
- Import an APEX application.
- Review the application to see how you can make predictions on the fly.
- Expose your ml model as a REST end point so any application can use it.

## **Step 1:**Prep data for the lab.

- To show how an application would use ml predictions we'll add some customer names to the original credit_scoring_100k data set.  Navigate to the SQL Developer Web and log in with ml_user (if you are not already logged in from the previous lab).  Then select file upload on the left.

  ![](./images/4/001.png  " ")

- Select the files button, and then the customer_names.csv file in the install directory.

  ![](./images/4/002.png  " ")

- Accept the defaults and hit next.

  ![](./images/4/003.png  " ")

- Change the customer\_id data type to number and change the lengths.

  ![](./images/4/004.png  " ")

- Accept the remaining defaults.

  ![](./images/4/005.png  " ")

- Create a view that combines the names with the credit_scoring_100k data set.
```
<copy>create or replace view ml_user.credit_scoring_100k_v as select a.first_name, a.last_name, b.*
from ml_user.customer_names a, credit_scoring_100k b
where a.customer_id(+)= b.customer_id;</copy>
```

  ![](./images/4/006.png  " ")

- Create a new upload\_customers table.  This will be used in the application to show how newly loaded records can be scored on the fly.
```
<copy>create table upload_customers (
customer_id number
, first_name varchar2(100)
, last_name varchar2(100)
, wealth varchar2(4000)
, income number
, customer_dmg_segment varchar2(26)
, customer_value_segment varchar2(26)
, occupation varchar2(26)
, highest_credit_card_limit number
, delinquency_status varchar2(26)
, max_cc_spent_amount number
, max_cc_spent_amount_prev number
, residental_status varchar2(26)
, likely_good_credit_pcnt AS (round((100*(prediction_probability(n1_class_model, 'Good Credit' USING 
    wealth
  , customer_dmg_segment
  , income
  , highest_credit_card_limit
  , residental_status
  , max_cc_spent_amount_prev
  , max_cc_spent_amount
  , occupation
  , delinquency_status
  , customer_value_segment
  , residental_status))),1))
, credit_prediction AS (prediction(n1_class_model USING   
  wealth
  , customer_dmg_segment
  , income
  , highest_credit_card_limit
  , residental_status
  , max_cc_spent_amount_prev
  , max_cc_spent_amount
  , occupation
  , delinquency_status
  , customer_value_segment
  , residental_status))
);</copy>
```

  ![](./images/4/007.png  " ")

## **Step 2:**Import the APEX Application

- Navigate to the ATP APEX application through the ATP Service Console.

  ![](./images/4/008.png  " ")

- Select Development, then APEX.

  ![](./images/4/009.png  " ")

- Enter your admin password.

  ![](./images/4/010.png  " ")

- You will be prompted to create a workspace. 

  ![](./images/4/011.png  " ")

- Select ML_USER for the workspace user and enter ML_APPLICATION for the workspace name.

  ![](./images/4/012.png  " ")

  ![](./images/4/013.png  " ")

- Sign out of user admin and log in with workspace ML_APPLICATION and user ML_USER.

  ![](./images/4/014.png  " ")

  ![](./images/4/015.png  " ")

   ![](./images/4/016.png  " ")

- You will be prompted to set the new application password for ml_user.  Make the email proper (not necessarily valid) and accept defaults.

   ![](./images/4/017.png  " ")

   ![](./images/4/018.png  " ")

- Select App Builder.

   ![](./images/4/019.png  " ")

- Select Import

   ![](./images/4/020.png  " ")

- Select choose file, and then select the f101.sql file in the git repo and then accept the defaults.

   ![](./images/4/021.png  " ")

   ![](./images/4/022.png  " ")

   ![](./images/4/023.png  " ")

   ![](./images/4/024.png  " ")

   ![](./images/4/025.png  " ")

   ![](./images/4/026.png  " ")

   ![](./images/4/027.png  " ")

   ![](./images/4/028.png  " ")

- Log in as ml_user.

   ![](./images/4/029.png  " ")

   ![](./images/4/030.png  " ")

## **Step 3:**Run application and review on-the-fly prediction/scoring.

- Select Customer Walk-in from the menu.  Select last name and then first name.  Note the credit score prediction and the probability of that estimate.  These calculations are done as the data is queried.

   ![](./images/4/031.png  " ")

-  Next we will upload new customers and score those as a batch.  Select the Home menu item at the bottom of the page.

   ![](./images/4/032.png  " ")

- Select SQL Workshop.

   ![](./images/4/033.png  " ")

- Select Utilities.

   ![](./images/4/034.png  " ")

- Select Data Workshop.

   ![](./images/4/035.png  " ")

- Select Load Data.

   ![](./images/4/036.png  " ")

- Select the upload_customers.xlsx file.

   ![](./images/4/037.png  " ")

- Load to existing table upload_customers.

   ![](./images/4/038.png  " ")

   ![](./images/4/039.png  " ")

- Return to the Alpha Office application.

   ![](./images/4/040.png  " ")

   ![](./images/4/041.png  " ")

- Run the application

   ![](./images/4/042.png  " ")

- Now review the uploaded customers and note the predictions.

   ![](./images/4/043.png  " ")

- Select Customer Upload Summary.  This provides a summary measure of the uploaded customer number of new good credit versus other credit customers.

   ![](./images/4/044.png  " ")

- Select Overall Credit Profile.  This provides an overall measure of the credit across the entire 100k credit database.  This scoring of 100k customers with 10 variables takes less than a second.

   ![](./images/4/045.png  " ")